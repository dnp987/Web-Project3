<!-- Use with cars_test1.js copied from test3.html -->
<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="/test.css" />
    <title>Cars database test</title>
  </head>
  <body>
    <h1>Cars Database test 1</h1>
    <p>Number of cars:</p>
    <div id="test"></div>
    <br>
    <div class = "row_test">
    </div>
    <input id = "btn1" type ="button" onclick="get_data(5000)" value="Get Data">
    <br>
    <br>
    <a href='http://localhost:5000'>Home</a> 

    <script type="text/javascript">
      function get_data(PORT) {
        var url = "http://localhost:" + PORT + "/car_data";
        console.log("POST: ", url);
        var data = {"low":5000, "high":7500}; //setup some test JSON data
        console.log(data);
        fetch(url, {method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data)}).then(response =>response.json())
        .then( (result) => {
            console.log('success: ', result);
            var res_length = result.length;
            var div1 = document.getElementById('test');
            div1.innerHTML = res_length;

            var row_test = document.getElementsByClassName('row_test')[0];
            var row_test2 = document.getElementsByClassName('row_test2');
            console.log("Before: " + row_test2.length);
            if (row_test2.length > 0){
              console.log("more than zero");
              //row_test.remove();   
            }
            for (var i = 0; i < res_length; i++){
              var year = result[i].year, make = result[i].make, 
                model = result[i].model, 
                price = result[i].price, 
                stock = result[i].stock_num,
                name = result[i].Name,
                location = result[i].Location,
                phone = result[i].Phone,
                url = result[i].URL;

              var row = document.createElement("div"); 
              row.classList.add('row_test2');
              row.innerHTML = i + " Year: " + year + " Make: " + make + " Model: " + model + " Price: " + price + " Stock #: " + stock + " Dealer: " + name + " Location: " + location + "URL: " + url;
              row_test.append(row);
            }
            console.log("After: " + row_test2.length);
        })
        .catch(error => console.log('error:', error));        
      }       
    </script>
  </body>
</html>